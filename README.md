# LLM 短期記憶解決探討
> 透過**人類實際對話的方式**，嘗試解決「LLM 在多輪對話中迷失」的問題。<br>
> 參考論文來源 [LLMs Get Lost In Multi-Turn Conversation](https://arxiv.org/abs/2505.06120)

## 真實對話過程
1. ### 持續在腦中更新摘要
  - 我們不會在腦中反覆重複整個歷史對話才進行對話
  - 而是維持動態的「當前理解」，並且會依據新消息而更新論點
  - 過往細節會淡化，但關鍵結論和限制條件會持續存在
2. ### 關鍵字觸發回想
  - 當有人說「我們前面討論的那個」
  - 我們會模糊搜尋近期記憶中的相關的訊息
  - 只有在參考關鍵字觸發時才會檢索特定細節

### 實作規劃
```
人類對話過程 → 工程話實踐

腦中摘要 → 透過小型模型在每輪後生成結構化摘要
內容回想 → 檢測到參考時模糊搜尋歷史對話（比對分數較高的訊息作為參考資料）
新對話 → 最新摘要 + 新問題
```

## 論文問題探討
> [LLMs Get Lost In Multi-Turn Conversation](https://arxiv.org/abs/2505.06120)

### LLM 在長對話的情境下普遍問題
針對**15 個 LLM 跨越 20 萬次以上對話**的研究顯示：
- 問題：<br>
  多輪對話性能下降 39%
- 原因：<br>
  LLM 使用「完整記憶」模型而非類人的選擇性記憶

### 四大問題

| LLM 問題 | 人類行為 | 新解決方案 |
| - | - | - |
| **過早解決方案** | 會先問澄清問題 | - |
| **資訊囤積** | 會遺忘無關細節 | 結構化摘要只保留相關資訊 |
| **線性重播** | 維持「當前狀態」 | 每輪刷新摘要 |
| **冗長螺旋** | 保持聚焦 | - |

## 記憶架構比較

### LLM 短期記憶：「完整記憶」（非人類模式）
```
第 1 輪：[question 1] + [response 1]
第 2 輪：[question 1] + [response 1] + [question 2] + [response 2]
第 3 輪：[question 1] + [response 1] + [question 2] + [response 2] + [question] + [response 3]
...
第 N 輪：[完整對話逐字記錄]
```
- 人類不會完整回憶所有內容
- 舊的無關資訊干擾當前內容生成，人類會排除無關訊息
- 沒有從錯誤中學習的機制，在長對話會被無關訊息干擾
- 線性增長的 token 導致對話串長度限制，人類不會因為一個對話過長而中斷

### 仿人類真實對話方法探討
```
每一輪：[結構化當前狀態] + [新問題] + [觸發的歷史脈絡]
```

#### 對話概要設計
```
核心討論
討論的問題
需求 
- 需求1
- 需求2
約束
- 約束1：需要依據 xxx 的資料
- 約束2：回答內容需要包含 xxx
排除
- 排除1：原因
- 排除2：原因
資料
- 資料1
- 資料2
最新結論:
最後對話的結論總結
```

## 人類對話模擬
> **模擬不完整記憶**：不是設計更好、更大的資訊檢索的支持，而是建造了像人類一樣處理資訊的系統

### 人類本質上不善於完整記憶
- 我們遺忘無關細節 
- 我們記住關鍵決策 
- 我們從錯誤中學習
- 我們內心都有把尺 
- 我們維持當前對話 

### 工程模擬重點
```
排除不必要的資訊：從關鍵概要中移除
聚焦維持：使用結構化摘要，類似腦中攏統概要
選擇性回想：關鍵字觸發搜尋實際對話內容
狀態更新：持續摘要，類似腦中的事件理解
```
- 不對完整內容做重播而是改為概要模擬人類籠統概要
- 總結為新概要來調整對話主軸模擬人類內心的觀點

#### 實作
1. **持續更新腦中觀點 → 自動摘要更新**（相關性的資訊保留 vs 完整歷史）<br>
  每次對話過程後，人類會無意識的情況下針對新接收的資訊更新對當前對話的總結，並以新觀點進行下一輪對話
2. **關鍵字觸發記憶回想 → 模糊搜尋系統**（聯想記憶啟動）<br>
  當對話『我們前面討論的那個』時，人類會搜尋近期記憶中的相關資訊
3. **當前狀態聚焦 → 固定脈絡架構**（結構化摘要）<br>
  動態調整當前對話主軸，非重新 review 整個對話歷史

| 認知模式 | 人類行為 | llm | 模擬實作 |
| - | - | - | - |
| **記憶管理** | 選擇性保留 | 完美回憶 | 結構化遺忘 |
| **錯誤學習** | 避免已知失敗 | 重複錯誤 | 排除選項追蹤 |
| **聚焦維持** | 當前狀態導向 | 歷史淹沒 | 基於摘要的脈絡 |
| **回想觸發** | 關鍵字啟動 | 總是開啟 | 參考檢測 |
